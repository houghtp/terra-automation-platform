<!-- Reset Password Form -->
<form hx-post="/auth/reset-password-confirm"
      hx-target="#reset-password-form-container"
      hx-swap="innerHTML"
      hx-indicator="#loading-indicator">

    <!-- Hidden token field -->
    <input type="hidden" name="token" value="{{ token }}">

    <div class="mb-3">
        <label for="new_password" class="form-label">New Password</label>
        <input type="password"
               class="form-control"
               id="new_password"
               name="new_password"
               required
               minlength="8"
               placeholder="Enter new password">
        <div class="form-text">
            Password must be at least 8 characters long and contain uppercase, lowercase, number, and special character.
        </div>
    </div>

    <div class="mb-3">
        <label for="confirm_password" class="form-label">Confirm Password</label>
        <input type="password"
               class="form-control"
               id="confirm_password"
               name="confirm_password"
               required
               minlength="8"
               placeholder="Confirm new password">
    </div>

    <button type="submit" class="btn btn-primary w-100 mb-3">
        <span id="loading-indicator" class="htmx-indicator">
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        </span>
        Reset Password
    </button>

    <div class="text-center">
        <a href="/auth/login" class="text-decoration-none">
            <i class="ti ti-arrow-left me-1"></i>
            Back to Login
        </a>
    </div>
</form>

<script>
// Add password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('new_password').value;
    const confirmPassword = this.value;

    if (password && confirmPassword && password !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
    } else {
        this.setCustomValidity('');
    }
});

document.getElementById('new_password').addEventListener('input', function() {
    const confirmPassword = document.getElementById('confirm_password');
    const event = new Event('input');
    confirmPassword.dispatchEvent(event);
});
</script>