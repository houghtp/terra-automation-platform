{% extends "base.html" %}

{% block title %}{{ content.title }} - Content Item{% endblock %}

{% block content %}
<div class="page-header d-print-none mb-4">
    <div class="row g-2 align-items-center">
        <div class="col">
            <!-- Breadcrumb Navigation -->
            <div class="page-pretitle">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/features/content-broadcaster">Content Broadcaster</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/features/content-broadcaster">Content Library</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">{{ content.title }}</li>
                    </ol>
                </nav>
            </div>
            <h2 class="page-title mb-0">
                <i class="ti ti-file-text me-2"></i>{{ content.title }}
            </h2>
        </div>
        <!-- Actions -->
        <div class="col-auto ms-auto d-print-none">
            <div class="btn-list">
                <a href="/features/content-broadcaster" class="btn">
                    <i class="ti ti-arrow-left me-1"></i>
                    Back to Library
                </a>
                <a href="#" class="btn btn-primary" onclick="editContent('{{ content.id }}')">
                    <i class="ti ti-edit me-1"></i>
                    Edit
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Status Badges -->
<div class="row mb-4">
    <div class="col-12">
        {% set state_colors = {
            'draft': 'secondary',
            'pending_approval': 'warning',
            'approved': 'success',
            'scheduled': 'info',
            'published': 'primary',
            'archived': 'dark'
        } %}
        <span class="badge bg-{{ state_colors.get(content.state, 'secondary') }} badge-lg">
            {{ content.state.replace('_', ' ').title() if content.state else 'Draft' }}
        </span>

        {% if content.approval_status %}
        <span class="badge bg-info badge-lg ms-2">
            Approval: {{ content.approval_status.replace('_', ' ').title() }}
        </span>
        {% endif %}

        {% if content.content_metadata and content.content_metadata.get('priority') %}
        <span class="badge bg-{{ 'danger' if content.content_metadata.get('priority') == 'urgent' else 'warning' if content.content_metadata.get('priority') == 'high' else 'info' }} badge-lg ms-2">
            {{ content.content_metadata.get('priority').title() }} Priority
        </span>
        {% endif %}
    </div>
</div>

<!-- Main Content Card -->
<div class="row">
    <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <!-- Content Stats -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="text-muted small">Word Count</div>
                                    <div class="h3 mb-0">
                                        {% set word_count = content.body.split()|length if content.body else 0 %}
                                        {{ word_count }}
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-muted small">Reading Time</div>
                                    <div class="h3 mb-0">
                                        {% set reading_time = (word_count / 200)|round|int %}
                                        {{ reading_time if reading_time > 0 else 1 }} min
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-muted small">Created</div>
                                    <div class="h3 mb-0">{{ content.created_at.strftime('%b %d, %Y') if content.created_at else 'Unknown' }}</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-muted small">Last Updated</div>
                                    <div class="h3 mb-0">
                                        {{ content.updated_at.strftime('%b %d, %Y') if content.updated_at else 'Never' }}
                                    </div>
                                </div>
                            </div>

                            <hr class="my-4">

                            <!-- Content Body -->
                            <div class="content-body" style="line-height: 1.8; font-size: 1rem;">
                                <div class="markdown-content">{{ content.body | safe }}</div>
                            </div>

                            <hr class="my-4">

                            <!-- Metadata Section -->
                            <div class="row">
                                <!-- Target Channels -->
                                {% if content.content_metadata and content.content_metadata.get('target_channels') %}
                                <div class="col-md-6 mb-3">
                                    <h4 class="mb-2">
                                        <i class="ti ti-broadcast me-2"></i>Target Channels
                                    </h4>
                                    <div class="d-flex flex-wrap gap-2">
                                        {% for channel in content.content_metadata.get('target_channels', []) %}
                                        <span class="badge bg-light text-dark">{{ channel }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Tags -->
                                {% if content.tags %}
                                <div class="col-md-6 mb-3">
                                    <h4 class="mb-2">
                                        <i class="ti ti-tags me-2"></i>Tags
                                    </h4>
                                    <div class="d-flex flex-wrap gap-2">
                                        {% for tag in content.tags %}
                                        <span class="badge bg-light text-primary">{{ tag }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Scheduled Date -->
                                {% if content.scheduled_at %}
                                <div class="col-md-6 mb-3">
                                    <h4 class="mb-2">
                                        <i class="ti ti-calendar me-2"></i>Scheduled Publication
                                    </h4>
                                    <div>{{ content.scheduled_at.strftime('%B %d, %Y at %I:%M %p') }}</div>
                                </div>
                                {% endif %}

                                <!-- Created By -->
                                {% if content.created_by %}
                                <div class="col-md-6 mb-3">
                                    <h4 class="mb-2">
                                        <i class="ti ti-user me-2"></i>Created By
                                    </h4>
                                    <div>{{ content.created_by }}</div>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Additional Metadata -->
                            {% if content.content_metadata %}
                            <div class="mt-4">
                                <h4 class="mb-3">
                                    <i class="ti ti-info-circle me-2"></i>Additional Information
                                </h4>
                                <div class="bg-light p-3 rounded">
                                    <pre class="m-0" style="white-space: pre-wrap; font-size: 0.875rem;">{{ content.content_metadata | tojson(indent=2) }}</pre>
                                </div>
                            </div>
                            {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Edit function using HTMX modal
function editContent(contentId) {
    editTabulatorRow(`/features/content-broadcaster/${contentId}/edit`);
}
</script>

<style>
.content-body {
    max-width: 800px;
    margin: 0 auto;
}

.markdown-content {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

.markdown-content h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-top: 2rem;
    margin-bottom: 1rem;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 0.5rem;
}

.markdown-content h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
}

.markdown-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 1.25rem;
    margin-bottom: 0.75rem;
}

.markdown-content p {
    margin-bottom: 1rem;
    line-height: 1.8;
}

.markdown-content ul, .markdown-content ol {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
}

.markdown-content li {
    margin-bottom: 0.5rem;
}

.markdown-content code {
    background: #f8f9fa;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.9em;
}

.markdown-content pre {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 4px;
    overflow-x: auto;
    margin-bottom: 1rem;
}
</style>
{% endblock %}
