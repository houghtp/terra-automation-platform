{% extends "base.html" %}

{% block title %}Content Broadcaster{% endblock %}

{% block head %}
<!-- Chart Widget Web Component -->
<script src="/dashboard/static/js/chart-widget.js"></script>
<!-- Stats Card Web Component -->
<script src="/dashboard/static/js/stats-card.js"></script>
<link rel="stylesheet" href="/static/css/tabulator-unified.css">
<!-- Table Base JavaScript -->
<script src="/features/core/static/js/table-base.js"></script>
{% endblock %}

{% block content %}

<!-- Navigation Tabs -->
<ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item" role="presentation">
        <a class="nav-link" href="/features/content-broadcaster/planning" role="tab">
            <i class="ti ti-bulb me-2"></i>
            Content Ideas
        </a>
    </li>
    <li class="nav-item" role="presentation">
        <a class="nav-link active" href="/features/content-broadcaster" role="tab">
            <i class="ti ti-file-text me-2"></i>
            Content Library
        </a>
    </li>
</ul>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="total-content-card"
            title="Total Content"
            description="All content items"
            icon="ti ti-file-text"
            color="blue"
            data-url="/features/content-broadcaster/api/summary"
            data-key="total_content"
            auto-refresh="300000">
        </stats-card>
    </div>

    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="pending-approvals-card"
            title="Pending Approvals"
            description="Awaiting review"
            icon="ti ti-clock"
            color="yellow"
            data-url="/features/content-broadcaster/api/summary"
            data-key="pending_approvals"
            auto-refresh="300000">
        </stats-card>
    </div>

    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="scheduled-content-card"
            title="Scheduled"
            description="Ready to publish"
            icon="ti ti-calendar"
            color="primary"
            data-url="/features/content-broadcaster/api/summary"
            data-key="scheduled_count"
            auto-refresh="300000">
        </stats-card>
    </div>

    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="published-content-card"
            title="Published"
            description="Live content"
            icon="ti ti-check"
            color="green"
            data-url="/features/content-broadcaster/api/summary"
            data-key="published_count"
            auto-refresh="300000">
        </stats-card>
    </div>
</div>

<!-- Main Content Table -->
<div class="card">
    <div class="card-header">
        {% set title = "Content Items" %}
        {% set description = "Create, approve, and schedule content for multi-channel publishing." %}
        {% set icon = "ti ti-broadcast" %}
        {% set add_url = "/features/content-broadcaster/partials/form" %}
        {% set entity_name = "Content" %}
        {% set table_id = "content-broadcaster-table" %}
        {% include 'components/ui/table_actions.html' with context %}
    </div>
    <div class="card-body p-0">
        <div id="generation-activity-panel" class="border-bottom px-3 py-2 d-none">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="d-flex align-items-center">
                    <i class="ti ti-activity-heartbeat me-2 text-primary"></i>
                    <h6 class="mb-0">Active Generations</h6>
                </div>
                <button
                    type="button"
                    class="btn btn-link btn-sm text-decoration-none"
                    id="clear-generation-activity"
                >
                    Clear completed
                </button>
            </div>
            <div id="generation-activity-list" class="list-unstyled mb-0"></div>
        </div>
        <div id="content-broadcaster-table"></div>
    </div>
</div>

<!-- HTMX Modal Container -->
<div class="modal modal-blur fade" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div id="modal-body">
                <!-- HTMX content will be loaded here -->
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/features/content-broadcaster/static/js/content-table.js"></script>
<script>
// Refresh stats cards helper function
function refreshContent() {
    if (window.contentTable) {
        window.contentTable.setData();
    }
    // Refresh stats cards
    document.querySelectorAll('stats-card').forEach(card => {
        if (card.refresh) card.refresh();
    });
}
</script>
{% endblock %}
