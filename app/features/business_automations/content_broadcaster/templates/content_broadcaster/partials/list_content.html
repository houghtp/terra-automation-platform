<!-- Enhanced Content List with SEO Indicators -->
<div id="content-table" class="table-responsive">
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th style="width: 40%;">Title</th>
                <th style="width: 15%;">State</th>
                <th style="width: 15%;">Approval</th>
                <th style="width: 10%;">SEO Score</th>
                <th style="width: 10%;">Created</th>
                <th style="width: 10%;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if content_items %}
                {% for item in content_items %}
                <tr data-content-id="{{ item.id }}" class="content-row">
                    <td>
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1">
                                <h6 class="mb-1 text-truncate" style="max-width: 300px;" title="{{ item.title }}">
                                    {{ item.title }}
                                </h6>
                                <div class="d-flex align-items-center gap-2">
                                    {% if item.tags %}
                                        {% for tag in item.tags[:3] %}
                                        <span class="status-badge status-neutral text-normal small">{{ tag }}</span>
                                        {% endfor %}
                                        {% if item.tags|length > 3 %}
                                        <span class="status-badge status-neutral text-normal small">+{{ item.tags|length - 3 }} more</span>
                                        {% endif %}
                                    {% endif %}

                                    <!-- AI Generated Indicator -->
                                    {% if item.content_metadata and item.content_metadata.get('generation_type') == 'seo_optimized' %}
                                    <span class="status-badge status-info text-normal small" title="AI-Generated SEO Content">
                                        <i class="ti ti-robot"></i> AI
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>

                    <td>
                        {% set state_colors = {
                            'draft': 'secondary',
                            'in_review': 'warning',
                            'approved': 'success',
                            'scheduled': 'info',
                            'publishing': 'primary',
                            'published': 'success',
                            'failed': 'danger',
                            'rejected': 'danger'
                        } %}
                        <span class="status-badge status-{{ state_colors.get(item.state, 'neutral') }}">
                            {% if item.state == 'in_review' %}In Review
                            {% elif item.state == 'approved' %}Approved
                            {% elif item.state == 'scheduled' %}Scheduled
                            {% elif item.state == 'publishing' %}Publishing
                            {% elif item.state == 'published' %}Published
                            {% elif item.state == 'failed' %}Failed
                            {% elif item.state == 'rejected' %}Rejected
                            {% else %}{{ item.state|title }}
                            {% endif %}
                        </span>
                    </td>

                    <td>
                        {% set approval_colors = {
                            'pending': 'warning',
                            'approved': 'success',
                            'rejected': 'danger'
                        } %}
                        <span class="status-badge status-{{ approval_colors.get(item.approval_status, 'neutral') }}">
                            {{ item.approval_status|title }}
                        </span>

                        {% if item.approved_by and item.approval_status == 'approved' %}
                        <div class="small text-muted mt-1">
                            by {{ item.approved_by[:8] }}...
                        </div>
                        {% endif %}
                    </td>

                    <td>
                        {% if item.content_metadata and item.content_metadata.get('seo_score') %}
                            {% set seo_score = item.content_metadata.get('seo_score', 0) %}
                            {% if seo_score >= 95 %}
                                <span class="status-badge status-success text-normal">{{ seo_score }}/100</span>
                            {% elif seo_score >= 85 %}
                                <span class="status-badge status-warning text-normal">{{ seo_score }}/100</span>
                            {% elif seo_score >= 70 %}
                                <span class="status-badge status-warning text-normal">{{ seo_score }}/100</span>
                            {% else %}
                                <span class="status-badge status-danger text-normal">{{ seo_score }}/100</span>
                            {% endif %}

                            <!-- AI Provider Info -->
                            {% if item.content_metadata.get('ai_provider') %}
                            <div class="small text-muted mt-1">
                                {{ item.content_metadata.get('ai_provider')|title }}
                                {% if item.content_metadata.get('fallback_ai') %}
                                + {{ item.content_metadata.get('fallback_ai')|title }}
                                {% endif %}
                            </div>
                            {% endif %}
                        {% else %}
                            <span class="text-muted small">-</span>
                        {% endif %}
                    </td>

                    <td>
                        <div class="small">
                            {{ item.created_at[:10] }}
                        </div>
                        <div class="small text-muted">
                            {{ item.created_at[11:16] }}
                        </div>
                    </td>

                    <td>
                        <div class="d-flex gap-1">
                            <!-- View/Edit Action -->
                            <button class="btn btn-sm btn-outline-primary"
                                    title="View Details"
                                    onclick="viewContentDetails('{{ item.id }}')">
                                <i class="ti ti-eye"></i>
                            </button>

                            <!-- State-specific actions -->
                            {% if item.state == 'draft' or item.state == 'rejected' %}
                                <button class="btn btn-sm btn-outline-secondary"
                                        title="Submit for Review"
                                        onclick="submitForReview('{{ item.id }}')">
                                    <i class="ti ti-send"></i>
                                </button>
                            {% endif %}

                            {% if item.approval_status == 'pending' and item.state == 'in_review' %}
                                <button class="btn btn-sm btn-outline-success"
                                        title="Approve"
                                        hx-get="/features/content-broadcaster/approve-modal/{{ item.id }}"
                                        hx-target="#modal-body"
                                        data-bs-toggle="modal"
                                        data-bs-target="#genericModal">
                                    <i class="ti ti-check"></i>
                                </button>

                                <button class="btn btn-sm btn-outline-danger"
                                        title="Reject"
                                        hx-get="/features/content-broadcaster/reject-modal/{{ item.id }}"
                                        hx-target="#modal-body"
                                        data-bs-toggle="modal"
                                        data-bs-target="#genericModal">
                                    <i class="ti ti-x"></i>
                                </button>
                            {% endif %}

                            {% if item.approval_status == 'approved' and item.state != 'scheduled' and item.state != 'published' %}
                                <button class="btn btn-sm btn-outline-info"
                                        title="Schedule"
                                        hx-get="/features/content-broadcaster/schedule-modal/{{ item.id }}"
                                        hx-target="#modal-body"
                                        data-bs-toggle="modal"
                                        data-bs-target="#genericModal">
                                    <i class="ti ti-calendar"></i>
                                </button>
                            {% endif %}

                            <!-- More Actions Dropdown -->
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle"
                                        type="button"
                                        id="moreActions{{ item.id }}"
                                        data-bs-toggle="dropdown">
                                    <i class="ti ti-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="editContent('{{ item.id }}')">
                                            <i class="ti ti-edit me-2"></i>Edit
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="duplicateContent('{{ item.id }}')">
                                            <i class="ti ti-copy me-2"></i>Duplicate
                                        </a>
                                    </li>
                                    {% if item.content_metadata and item.content_metadata.get('seo_score') %}
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="showSEODetails('{{ item.id }}')">
                                            <i class="ti ti-chart-line me-2"></i>SEO Details
                                        </a>
                                    </li>
                                    {% endif %}
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item text-danger" href="#" onclick="deleteContent('{{ item.id }}')">
                                            <i class="ti ti-trash me-2"></i>Delete
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <div class="text-muted">
                            <i class="ti ti-file-text fs-1 d-block mb-3"></i>
                            <h6>No content found</h6>
                            <p class="mb-3">Start by creating your first piece of content.</p>
                            <button class="btn btn-primary"
                                    hx-get="/features/content-broadcaster/create-modal"
                                    hx-target="#modal-body"
                                    data-bs-toggle="modal"
                                    data-bs-target="#genericModal">
                                <i class="ti ti-plus me-1"></i>Create Content
                            </button>
                        </div>
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>

    {% if total > content_items|length %}
    <div class="d-flex justify-content-center py-3">
        <button class="btn btn-outline-primary" onclick="loadMoreContent()">
            <i class="ti ti-reload me-1"></i>
            Load More ({{ total - content_items|length }} remaining)
        </button>
    </div>
    {% endif %}
</div>

<!-- Success/Error Messages -->
{% if show_success %}
<div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
    <i class="ti ti-check-circle me-2"></i>
    {{ success_message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endif %}

{% if show_error %}
<div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
    <i class="ti ti-alert-circle me-2"></i>
    {{ error_message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endif %}

<script>
// Content management functions
function viewContentDetails(contentId) {
    // TODO: Implement content details modal
    console.log('View content details:', contentId);
}

function editContent(contentId) {
    // TODO: Implement edit content modal
    console.log('Edit content:', contentId);
}

function submitForReview(contentId) {
    if (confirm('Submit this content for review?')) {
        htmx.ajax('POST', `/features/content-broadcaster/api/${contentId}/submit`, {
            target: '#content-table',
            swap: 'outerHTML'
        });
    }
}

function duplicateContent(contentId) {
    // TODO: Implement content duplication
    console.log('Duplicate content:', contentId);
}

function deleteContent(contentId) {
    if (confirm('Are you sure you want to delete this content? This action cannot be undone.')) {
        htmx.ajax('DELETE', `/features/content-broadcaster/api/${contentId}`, {
            target: '#content-table',
            swap: 'outerHTML'
        });
    }
}

function showSEODetails(contentId) {
    // TODO: Implement SEO details modal
    console.log('Show SEO details for:', contentId);
}

function loadMoreContent() {
    // TODO: Implement pagination
    console.log('Load more content');
}

// Auto-refresh for content in generating state
document.addEventListener('DOMContentLoaded', function() {
    const generatingRows = document.querySelectorAll('.content-row');
    let hasGeneratingContent = false;

    generatingRows.forEach(row => {
        const state = row.querySelector('.badge').textContent.trim();
        if (state === 'Publishing' || state === 'In Review') {
            hasGeneratingContent = true;
        }
    });

    // Auto-refresh every 15 seconds if there's content being generated
    if (hasGeneratingContent) {
        setTimeout(() => {
            htmx.trigger('#content-table', 'refresh');
        }, 15000);
    }
});
</script>

<style>
.table th {
    border-bottom: 2px solid #dee2e6;
    font-weight: 600;
    color: #495057;
}

.content-row:hover {
    background-color: #f8f9fa;
}

.badge {
    font-size: 0.75rem;
}

.dropdown-toggle::after {
    display: none;
}

/* SEO Score colors */
.bg-orange {
    background-color: #fd7e14 !important;
    color: white;
}

.table-responsive {
    border-radius: 0.375rem;
    border: 1px solid #dee2e6;
}
</style>
