{% extends "base.html" %}

{% block title %}Messages{% endblock %}

{% block head %}
<script src="/features/core/static/js/table-base.js"></script>
{% endblock %}

{% block content %}
<div class="page-header d-print-none">
    <div class="row align-items-center">
        <div class="col">
            <div class="page-pretitle">Community</div>
            <h2 class="page-title">{{ page_title }}</h2>
            <div class="text-muted mt-1">{{ page_description }}</div>
        </div>
        <div class="col-auto ms-auto">
            <button class="btn btn-primary" id="compose-message-btn" hx-get="/features/community/messages/partials/form" hx-target="#modal-body" hx-swap="innerHTML">
                <i class="ti ti-edit me-1"></i> Compose
            </button>
        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-12 col-lg-5">
        <div class="card h-100">
            <div class="card-header">
                <h3 class="card-title mb-0">
                    <i class="ti ti-inbox me-2"></i> Conversations
                </h3>
            </div>
            <div class="card-body p-0">
                <div id="messages-table"></div>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-7">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="card-title mb-0"><i class="ti ti-message me-2"></i>Thread</h3>
                    <p class="text-muted mb-0">Select a conversation to view messages.</p>
                </div>
                <button class="btn btn-outline-primary btn-sm" id="refresh-thread-btn" disabled>
                    <i class="ti ti-refresh"></i>
                </button>
            </div>
            <div class="card-body" id="thread-view">
                <div class="empty">
                    <div class="empty-icon"><i class="ti ti-messages"></i></div>
                    <p class="empty-title">No thread selected</p>
                    <p class="empty-subtitle text-muted">Choose a conversation from the left to see the history.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div id="modal-body"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  window.currentMemberId = "{{ member_id }}";
</script>
<script src="/features/community/static/js/messages.js"></script>
{% endblock %}
