{% set mode = form_mode or 'create' %}
{% set action_url = "/features/community/content/news" if mode == "create" else "/features/community/content/news/" ~ news.id %}
{% set form_values = form_data if form_data is defined else news %}
{% set publish_value = "" %}
{% if form_data is defined and form_data %}
  {% set publish_value = form_data.publish_date or "" %}
{% elif news and news.publish_date %}
  {% set publish_value = news.publish_date %}
{% endif %}

<div class="modal-header">
    <h5 class="modal-title">
        {% if mode == "edit" %}Edit News Item{% else %}Add News Item{% endif %}
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<form
    hx-post="{{ action_url }}"
    hx-target="#content-form-modal-body"
    hx-swap="innerHTML"
    id="news-form">
    <div class="modal-body">
        {% if errors.get("general") %}
        <div class="alert alert-danger">
            {{ errors.get("general")[0] }}
        </div>
        {% endif %}

        <div class="mb-3">
            <label class="form-label">Headline</label>
            <input type="text" name="headline" class="form-control" required value="{{ form_values.headline if form_values else '' }}">
            {% if errors.get("headline") %}
            <div class="text-danger small mt-1">
                {% for message in errors.get("headline") %}
                <div>{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label class="form-label">Source URL</label>
            <input type="url" name="url" class="form-control" required placeholder="https://..." value="{{ form_values.url if form_values else '' }}">
            {% if errors.get("url") %}
            <div class="text-danger small mt-1">
                {% for message in errors.get("url") %}
                <div>{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Source</label>
                <input type="text" name="source" class="form-control" value="{{ form_values.source if form_values else '' }}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Category</label>
                <input type="text" name="category" class="form-control" value="{{ form_values.category if form_values else '' }}">
            </div>
        </div>

        <div class="mb-3 mt-3">
            <label class="form-label">Publish Date</label>
            <input type="datetime-local" name="publish_date" class="form-control" value="{{ publish_value }}">
            {% if errors.get("publish_date") %}
            <div class="text-danger small mt-1">
                {% for message in errors.get("publish_date") %}
                <div>{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label class="form-label">Summary</label>
            <textarea name="summary" class="form-control" rows="4">{{ form_values.summary if form_values else '' }}</textarea>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">
            <i class="ti ti-device-floppy me-1"></i>
            {% if mode == "edit" %}Save News{% else %}Add News{% endif %}
        </button>
    </div>
</form>
