<div class="modal-header">
  <h5 class="modal-title">{{ 'Edit' if secret else 'Create' }} Secret</h5>
</div>

<form
  id="secret-form"
  hx-post="{{ '/administration/secrets/new' if not secret else '/administration/secrets/' ~ secret.id ~ '/edit' }}"
  autocomplete="off"
>
  <div class="modal-body">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Secret Name *</label>
        <input
          name="name"
          value="{{ secret.name if secret else '' }}"
          required
          class="form-control"
          placeholder="e.g., OpenAI API Key"
          maxlength="255"
        />
        <small class="form-hint">A descriptive name to identify this secret.</small>
      </div>

      <div class="col-md-6">
        <label class="form-label">Secret Type</label>
        <select name="secret_type" class="form-control" required>
          {% for type_value in secret_types %}
          <option value="{{ type_value }}"
                  {{ 'selected' if secret and secret.secret_type == type_value else '' }}>
            {{ type_value.replace('_', ' ').title() }}
          </option>
          {% endfor %}
        </select>
        <small class="form-hint">Categorize the type of secret for better organization.</small>
      </div>

      <div class="col-12">
        <label class="form-label">Description</label>
        <textarea
          name="description"
          rows="2"
          class="form-control"
          placeholder="Optional description of what this secret is used for..."
          maxlength="1000"
        >{{ secret.description if secret else '' }}</textarea>
        <small class="form-hint">Optional description to help identify the purpose of this secret.</small>
      </div>

      <div class="col-12">
        <label class="form-label">Secret Value *</label>
        <div class="input-group">
          <textarea
            name="value"
            rows="3"
            class="form-control"
            placeholder="Enter the secret value (API key, token, password, etc.)"
            {{ 'required' if not secret else '' }}
            style="font-family: monospace;"
          ></textarea>
        </div>
        <small class="form-hint">
          {% if secret %}
          Leave empty to keep the current value. Enter a new value to update.
          {% else %}
          The secret value will be encrypted and stored securely.
          {% endif %}
        </small>
      </div>

      <!-- Advanced Options Accordion -->
      <div class="col-12">
        <div class="accordion" id="advancedOptions">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseAdvanced"
                      aria-expanded="false">
                Advanced Options
              </button>
            </h2>
            <div id="collapseAdvanced" class="accordion-collapse collapse">
              <div class="accordion-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Expiration Date</label>
                    <input
                      name="expires_at"
                      type="datetime-local"
                      class="form-control"
                      value="{{ secret.expires_at.strftime('%Y-%m-%dT%H:%M') if secret and secret.expires_at else '' }}"
                    />
                    <small class="form-hint">Optional: Set when this secret should expire.</small>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">Auto-rotation Interval (days)</label>
                    <input
                      name="rotation_interval_days"
                      type="number"
                      class="form-control"
                      value="{{ secret.rotation_interval_days if secret else '' }}"
                      min="1"
                      max="365"
                      placeholder="e.g., 90"
                    />
                    <small class="form-hint">Optional: Automatically remind to rotate this secret every X days.</small>
                  </div>

                  {% if secret %}
                  <div class="col-12">
                    <label class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        name="is_active"
                        value="true"
                        {{ 'checked' if secret.is_active else '' }}
                      />
                      <span class="form-check-label">Active</span>
                    </label>
                    <small class="form-hint">Inactive secrets are hidden from normal operations but preserved for audit.</small>
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
      <i class="ti ti-x icon"></i>
      Cancel
    </button>
    <button type="submit" class="btn btn-outline-primary">
      <i class="ti ti-check icon"></i>
      {{ 'Update' if secret else 'Create' }}
    </button>
  </div>
</form>
