{% extends "base.html" %}
{% block title %}Audit Logs{% endblock %}
{% block page_title %}Audit Logs{% endblock %}
{% block head %}
<!-- Chart Widget Web Component -->
<script src="/dashboard/static/js/chart-widget.js?v=tabler"></script>
<!-- Stats Card Web Component -->
<script src="/dashboard/static/js/stats-card.js?v=tabler"></script>
<!-- Table Base JavaScript -->
<script src="/features/core/static/js/table-base.js"></script>
{% endblock %}
{% block content %}

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="total-logs-card"
            title="Total Logs"
            description="All audit entries"
            icon="ti ti-file-text"
            color="blue"
            data-url="/features/administration/audit/api/stats"
            data-key="total_logs"
            auto-refresh="300000">
        </stats-card>
    </div>

    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="recent-24h-card"
            title="Last 24 Hours"
            description="Recent activity"
            icon="ti ti-clock"
            color="green"
            data-url="/features/administration/audit/api/stats"
            data-key="recent_24h"
            auto-refresh="300000">
        </stats-card>
    </div>

    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="security-events-card"
            title="Security Events"
            description="Warnings & errors"
            icon="ti ti-shield-alert"
            color="red"
            data-url="/features/administration/audit/api/stats"
            data-key="security_events"
            auto-refresh="300000">
        </stats-card>
    </div>

    <div class="col-sm-6 col-lg-3">
        <stats-card
            id="categories-card"
            title="Categories"
            description="Activity types"
            icon="ti ti-category"
            color="primary"
            data-url="/features/administration/audit/api/stats"
            data-key="categories_count"
            auto-refresh="300000">
        </stats-card>
    </div>
</div>

<!-- Security Alert -->
<div class="alert alert-warning d-none" id="security-alert">
    <div class="d-flex">
        <div>
            <i class="ti ti-shield-alert alert-icon"></i>
        </div>
        <div>
            <h4 class="alert-title">Security Events Detected!</h4>
            <div class="text-muted">
                <span id="security-alert-count">0</span> security event(s) require attention.
                <a href="#" onclick="filterBySeverity('WARNING,ERROR,CRITICAL')" class="alert-link">Review now</a>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Filters -->
<div class="card audit-filters mb-4">
    <div class="card-body">
        <h5 class="card-title mb-3">Advanced Filters</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Category</label>
                <select class="form-select" id="filter-category" onchange="applyTableFilters()">
                    <option value="">All Categories</option>
                    <option value="AUTH">Authentication</option>
                    <option value="DATA">Data Operations</option>
                    <option value="ADMIN">Administration</option>
                    <option value="API">API Access</option>
                    <option value="SYSTEM">System Events</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Severity</label>
                <select class="form-select" id="filter-severity" onchange="applyTableFilters()">
                    <option value="">All Severity</option>
                    <option value="INFO">Info</option>
                    <option value="WARNING">Warning</option>
                    <option value="ERROR">Error</option>
                    <option value="CRITICAL">Critical</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Date From</label>
                <input type="date" class="form-control" id="filter-date-from" onchange="applyTableFilters()">
            </div>
            <div class="col-md-3">
                <label class="form-label">Date To</label>
                <input type="date" class="form-control" id="filter-date-to" onchange="applyTableFilters()">
            </div>
        </div>
        <div class="row g-3 mt-2">
            <div class="col-md-6">
                <label class="form-label">User</label>
                <input type="text" class="form-control" id="filter-user" placeholder="Filter by user email..." onchange="applyTableFilters()">
            </div>
            <div class="col-md-6">
                <label class="form-label">Action</label>
                <input type="text" class="form-control" id="filter-action" placeholder="Filter by action..." onchange="applyTableFilters()">
            </div>
        </div>
        <div class="mt-3">
            <button type="button" class="btn btn-primary" onclick="applyTableFilters()">
                <i class="ti ti-filter me-2"></i>Apply Filters
            </button>
            <button type="button" class="btn btn-outline-secondary ms-2" onclick="clearTableFilters()">
                <i class="ti ti-x me-2"></i>Clear Filters
            </button>
        </div>
    </div>
</div>

<!-- Activity Timeline Chart -->
<div class="row mb-4">
    <div class="col-12">
        <chart-widget
            type="line"
            title="Activity Timeline"
            icon="ti ti-chart-line"
            data-url="/features/administration/audit/api/timeline?days=7"
            height="300"
            description="Audit activity breakdown by category over the last 7 days"
            class="chart-widget">
        </chart-widget>
    </div>
</div>

<div id="audit-area">
  <div id="audit-table-container">
    {% include "audit/partials/list_content.html" %}
  </div>
</div>

<!-- Tabler Modal -->
<div class="modal modal-blur fade" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div id="modal-body">
        <!-- Modal content will be loaded here via HTMX -->
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Audit table configuration (Tabulator operations) -->
<script src="/features/administration/audit/static/js/audit-table.js"></script>
{% endblock %}
